<mat-card class="fuel-expense-form">
  <mat-card-header class="form-header">
    <mat-card-title>{{ isEditMode ? 'Edit Fuel Expense' : 'Add New Fuel Expense' }}</mat-card-title>
    <mat-card-actions>
      <button mat-stroked-button (click)="onCancel()" class="back-btn">
        <mat-icon>arrow_back</mat-icon>
        Back to List
      </button>
    </mat-card-actions>
  </mat-card-header>

  <mat-card-content>
    <form [formGroup]="fuelExpenseForm" (ngSubmit)="onSubmit()" class="expense-form">
      <div class="form-row">
        <mat-form-field class="form-group" appearance="outline">
          <mat-label>Expense Type *</mat-label>
          <mat-select id="expense_type" formControlName="expense_type">
            <mat-option value="">Select Expense Type</mat-option>
            <mat-option value="fuel">Fuel</mat-option>
            <mat-option value="maintenance">Maintenance</mat-option>
            <mat-option value="insurance">Insurance</mat-option>
            <mat-option value="toll">Toll</mat-option>
            <mat-option value="parking">Parking</mat-option>
            <mat-option value="other">Other</mat-option>
          </mat-select>
          <mat-error *ngIf="fuelExpenseForm.get('expense_type')?.invalid && fuelExpenseForm.get('expense_type')?.touched">
            Expense type is required
          </mat-error>
        </mat-form-field>

        <mat-form-field class="form-group" appearance="outline">
          <mat-label>Expense Date *</mat-label>
          <input matInput [matDatepicker]="datePicker" formControlName="expense_date" />
          <mat-datepicker-toggle matSuffix [for]="datePicker"></mat-datepicker-toggle>
          <mat-datepicker #datePicker></mat-datepicker>
          <mat-error *ngIf="fuelExpenseForm.get('expense_date')?.invalid && fuelExpenseForm.get('expense_date')?.touched">
            Expense date is required
          </mat-error>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field class="form-group" appearance="outline">
          <mat-label>Cost (R) *</mat-label>
          <input matInput type="number" id="cost" formControlName="cost" step="0.01" min="0">
          <mat-error *ngIf="fuelExpenseForm.get('cost')?.invalid && fuelExpenseForm.get('cost')?.touched">
            <span *ngIf="fuelExpenseForm.get('cost')?.errors?.['required']">Cost is required</span>
            <span *ngIf="fuelExpenseForm.get('cost')?.errors?.['min']">Cost must be positive</span>
          </mat-error>
        </mat-form-field>

        <mat-form-field class="form-group" appearance="outline">
          <mat-label>Fuel Type</mat-label>
          <mat-select id="fuel_type" formControlName="fuel_type">
            <mat-option value="">Select Fuel Type</mat-option>
            <mat-option value="petrol">Petrol</mat-option>
            <mat-option value="diesel">Diesel</mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field class="form-group" appearance="outline">
          <mat-label>Quantity (Liters)</mat-label>
          <input matInput type="number" id="quantity" formControlName="quantity" step="0.01" min="0">
          <mat-error *ngIf="fuelExpenseForm.get('quantity')?.invalid && fuelExpenseForm.get('quantity')?.touched">
            Quantity must be positive
          </mat-error>
        </mat-form-field>

        <mat-form-field class="form-group" appearance="outline">
          <mat-label>Location</mat-label>
          <input matInput type="text" id="location" formControlName="location" placeholder="Enter location">
        </mat-form-field>
      </div>

      <div class="form-row">
        <div class="time-group">
          <mat-form-field class="form-group time-field" appearance="outline">
            <mat-label>Hour</mat-label>
            <mat-select formControlName="hour">
              <mat-option *ngFor="let hour of hours" [value]="hour">{{ hour }}</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field class="form-group time-field" appearance="outline">
            <mat-label>Minute</mat-label>
            <mat-select formControlName="minute">
              <mat-option *ngFor="let minute of minutes" [value]="minute">{{ minute }}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div class="form-group toggle-group">
          <mat-label>Recurring Expense</mat-label>
          <mat-slide-toggle formControlName="is_recurring">Recurring</mat-slide-toggle>
        </div>
      </div>

      <div class="form-row">
        <mat-form-field class="form-group" appearance="outline">
          <mat-label>Vehicle</mat-label>
          <mat-select id="vehicle_id" formControlName="vehicle_id">
            <mat-option value="">Select Vehicle</mat-option>
            <mat-option *ngFor="let vehicle of vehicles" [value]="vehicle.id">
              {{ vehicle.name }} - {{ vehicle.registrationNumber }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field class="form-group" appearance="outline">
          <mat-label>Driver</mat-label>
          <mat-select id="driver_id" formControlName="driver_id">
            <mat-option value="">Select Driver</mat-option>
            <mat-option *ngFor="let driver of drivers" [value]="driver.id">
              {{ driver.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <div class="form-actions">
        <button mat-stroked-button type="button" (click)="onCancel()" class="cancel-btn">Cancel</button>
        <button mat-raised-button type="submit" [disabled]="loading || fuelExpenseForm.invalid" class="submit-btn" color="primary">
          <mat-spinner *ngIf="loading" diameter="20"></mat-spinner>
          <mat-icon *ngIf="!loading">{{ isEditMode ? 'save' : 'add' }}</mat-icon>
          {{ isEditMode ? 'Update' : 'Create' }} Expense
        </button>
      </div>
    </form>
  </mat-card-content>
</mat-card>
