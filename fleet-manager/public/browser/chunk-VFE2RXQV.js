import{a as be,b as Fe}from"./chunk-YPIGO5KQ.js";import{a as Se}from"./chunk-2HV7KA3P.js";import{a as ue,b as ce,c as fe,d as xe,f as ve}from"./chunk-3XDGEVN2.js";import{a as Ee,b as he}from"./chunk-YUH7H455.js";import{c as ge}from"./chunk-67IAFLRI.js";import{b as T,d as x,f as N,g as V,i as q,j as R,k as j,l as A,n as z,o as B,p as G,t as ee,u as te}from"./chunk-SAZJTF6N.js";import{a as J,b as K,d as W,g as X,h as Z}from"./chunk-IUCOVMK4.js";import{a as le,b as me}from"./chunk-FFLQZGHZ.js";import{a as ae}from"./chunk-3YM7IDPM.js";import{a as de}from"./chunk-WNOI4ZBI.js";import{a as _e}from"./chunk-F4ZXE7SN.js";import{a as pe,b as se}from"./chunk-7SN2W6C3.js";import"./chunk-TMZC4RWW.js";import"./chunk-JKTBMZC7.js";import"./chunk-5KAHAUYY.js";import{A as $,B as L,C as Y,E as H,F as Q,G as U,R as ie,S as ne,X as re,Y as oe}from"./chunk-7UVTZ53J.js";import{$a as F,Aa as M,Fa as d,Qa as m,Ra as t,Rb as O,Sa as e,Sb as P,Ta as f,Vb as w,Y as _,Ya as y,Z as E,_a as h,cc as k,ec as D,jb as C,nb as n,ob as v,pb as S,qb as I,sa as l,wa as c}from"./chunk-7SSOWWR7.js";function ye(o,a){o&1&&(t(0,"mat-error"),n(1," Expense type is required "),e())}function Ce(o,a){o&1&&(t(0,"mat-error"),n(1," Expense date is required "),e())}function Ie(o,a){o&1&&(t(0,"span"),n(1,"Cost is required"),e())}function Oe(o,a){o&1&&(t(0,"span"),n(1,"Cost must be positive"),e())}function Pe(o,a){if(o&1&&(t(0,"mat-error"),d(1,Ie,2,0,"span",15)(2,Oe,2,0,"span",15),e()),o&2){let r,i,p=F();l(),m("ngIf",(r=p.fuelExpenseForm.get("cost"))==null||r.errors==null?null:r.errors.required),l(),m("ngIf",(i=p.fuelExpenseForm.get("cost"))==null||i.errors==null?null:i.errors.min)}}function we(o,a){o&1&&(t(0,"mat-error"),n(1," Quantity must be positive "),e())}function ke(o,a){if(o&1&&(t(0,"mat-option",37),n(1),e()),o&2){let r=a.$implicit;m("value",r),l(),v(r)}}function De(o,a){if(o&1&&(t(0,"mat-option",37),n(1),e()),o&2){let r=a.$implicit;m("value",r),l(),v(r)}}function Te(o,a){if(o&1&&(t(0,"mat-option",37),n(1),e()),o&2){let r=a.$implicit;m("value",r.id),l(),I(" ",r.name," - ",r.registrationNumber," ")}}function Ne(o,a){if(o&1&&(t(0,"mat-option",37),n(1),e()),o&2){let r=a.$implicit;m("value",r.id),l(),S(" ",r.name," ")}}function Ve(o,a){o&1&&f(0,"mat-spinner",38)}function qe(o,a){if(o&1&&(t(0,"mat-icon"),n(1),e()),o&2){let r=F();l(),v(r.isEditMode?"save":"add")}}var Me=class o{constructor(a,r,i,p,s,u,g,b){this.fb=a;this.fuelExpenseService=r;this.vehicleService=i;this.driverService=p;this.popupService=s;this.router=u;this.route=g;this.dialog=b;this.fuelExpenseForm=this.fb.group({expense_type:["",x.required],expense_date:["",x.required],cost:["",[x.required,x.min(0)]],fuel_type:[""],quantity:["",x.min(0)],location:[""],hour:[""],minute:[""],is_recurring:[!1],vehicle_id:[""],driver_id:[""]})}fuelExpenseForm;isEditMode=!1;fuelExpenseId=null;vehicles=[];drivers=[];loading=!1;hours=[];minutes=[];ngOnInit(){this.fuelExpenseId=this.route.snapshot.paramMap.get("id"),this.isEditMode=!!this.fuelExpenseId,console.log(this.isEditMode,"ID:",this.fuelExpenseId,"Edited successfully"),this.hours=Array.from({length:24},(a,r)=>r.toString().padStart(2,"0")),this.minutes=Array.from({length:60},(a,r)=>r.toString().padStart(2,"0")),this.loadVehicles(),this.loadDrivers(),this.isEditMode&&this.fuelExpenseId&&this.loadFuelExpense(this.fuelExpenseId)}loadVehicles(){this.vehicleService.getVehicles().subscribe({next:a=>this.vehicles=a,error:a=>this.popupService.showError("Failed to load vehicles")})}loadDrivers(){this.driverService.getDrivers().subscribe({next:a=>this.drivers=a,error:a=>this.popupService.showError("Failed to load drivers")})}loadFuelExpense(a){this.fuelExpenseService.getFuelExpense(a).subscribe({next:r=>{this.fuelExpenseForm.patchValue(r)},error:r=>this.popupService.showError("Failed to load fuel expense")})}onSubmit(){console.log("Form submitted"),this.fuelExpenseForm.valid?(console.log("Form is valid"),this.dialog.open(se,{data:{message:this.isEditMode?"Are you sure you want to update this fuel expense?":"Are you sure you want to add this fuel expense?"}}).afterClosed().subscribe(r=>{if(r){this.loading=!0;let i=this.fuelExpenseForm.value;console.log("Form values:",i);let p=i.hour&&i.minute?`${i.hour}:${i.minute}`:void 0,s={expense_type:i.expense_type,expense_date:i.expense_date,cost:i.cost,fuel_type:i.fuel_type||null,quantity:i.quantity||null,location:i.location||null,time:p,is_recurring:i.is_recurring||!1,vehicle_id:i.vehicle_id||null,driver_id:i.driver_id||null};console.log("FuelExpenseForm: Prepared data:",s),this.isEditMode&&this.fuelExpenseId?this.fuelExpenseService.updateFuelExpense(this.fuelExpenseId,s).subscribe({next:()=>{console.log("Update successful"),this.popupService.showSuccess("Fuel expense updated successfully"),this.router.navigate(["/fuel-expenses"])},error:u=>{this.popupService.showError("Failed to update fuel expense"),this.loading=!1}}):this.fuelExpenseService.addFuelExpense(s).subscribe({next:u=>{console.log("Create successful:",u),this.popupService.showSuccess("Fuel expense created successfully"),this.router.navigate(["/fuel-expenses"])},error:u=>{this.popupService.showError("Failed to create fuel expense"),this.loading=!1}})}})):this.popupService.showError("Please fill in all required fields correctly")}onCancel(){this.router.navigate(["/fuel-expenses"])}static \u0275fac=function(r){return new(r||o)(c(B),c(Se),c(de),c(_e),c(ae),c(D),c(k),c(pe))};static \u0275cmp=M({type:o,selectors:[["app-fuel-expense-form"]],decls:104,vars:16,consts:[["datePicker",""],[1,"fuel-expense-form"],[1,"form-header"],["mat-stroked-button","",1,"back-btn",3,"click"],[1,"expense-form",3,"ngSubmit","formGroup"],[1,"form-row"],["appearance","outline",1,"form-group"],["id","expense_type","formControlName","expense_type"],["value",""],["value","fuel"],["value","maintenance"],["value","insurance"],["value","toll"],["value","parking"],["value","other"],[4,"ngIf"],["matInput","","formControlName","expense_date",3,"matDatepicker"],["matSuffix","",3,"for"],["matInput","","type","number","id","cost","formControlName","cost","step","0.01","min","0"],["id","fuel_type","formControlName","fuel_type"],["value","petrol"],["value","diesel"],["matInput","","type","number","id","quantity","formControlName","quantity","step","0.01","min","0"],["matInput","","type","text","id","location","formControlName","location","placeholder","Enter location"],[1,"time-group"],["appearance","outline",1,"form-group","time-field"],["formControlName","hour"],[3,"value",4,"ngFor","ngForOf"],["formControlName","minute"],[1,"form-group","toggle-group"],["formControlName","is_recurring"],["id","vehicle_id","formControlName","vehicle_id"],["id","driver_id","formControlName","driver_id"],[1,"form-actions"],["mat-stroked-button","","type","button",1,"cancel-btn",3,"click"],["mat-raised-button","","type","submit","color","primary",1,"submit-btn",3,"disabled"],["diameter","20",4,"ngIf"],[3,"value"],["diameter","20"]],template:function(r,i){if(r&1){let p=y();t(0,"mat-card",1)(1,"mat-card-header",2)(2,"mat-card-title"),n(3),e(),t(4,"mat-card-actions")(5,"button",3),h("click",function(){return _(p),E(i.onCancel())}),t(6,"mat-icon"),n(7,"arrow_back"),e(),n(8," Back to List "),e()()(),t(9,"mat-card-content")(10,"form",4),h("ngSubmit",function(){return _(p),E(i.onSubmit())}),t(11,"div",5)(12,"mat-form-field",6)(13,"mat-label"),n(14,"Expense Type *"),e(),t(15,"mat-select",7)(16,"mat-option",8),n(17,"Select Expense Type"),e(),t(18,"mat-option",9),n(19,"Fuel"),e(),t(20,"mat-option",10),n(21,"Maintenance"),e(),t(22,"mat-option",11),n(23,"Insurance"),e(),t(24,"mat-option",12),n(25,"Toll"),e(),t(26,"mat-option",13),n(27,"Parking"),e(),t(28,"mat-option",14),n(29,"Other"),e()(),d(30,ye,2,0,"mat-error",15),e(),t(31,"mat-form-field",6)(32,"mat-label"),n(33,"Expense Date *"),e(),f(34,"input",16)(35,"mat-datepicker-toggle",17)(36,"mat-datepicker",null,0),d(38,Ce,2,0,"mat-error",15),e()(),t(39,"div",5)(40,"mat-form-field",6)(41,"mat-label"),n(42,"Cost (R) *"),e(),f(43,"input",18),d(44,Pe,3,2,"mat-error",15),e(),t(45,"mat-form-field",6)(46,"mat-label"),n(47,"Fuel Type"),e(),t(48,"mat-select",19)(49,"mat-option",8),n(50,"Select Fuel Type"),e(),t(51,"mat-option",20),n(52,"Petrol"),e(),t(53,"mat-option",21),n(54,"Diesel"),e()()()(),t(55,"div",5)(56,"mat-form-field",6)(57,"mat-label"),n(58,"Quantity (Liters)"),e(),f(59,"input",22),d(60,we,2,0,"mat-error",15),e(),t(61,"mat-form-field",6)(62,"mat-label"),n(63,"Location"),e(),f(64,"input",23),e()(),t(65,"div",5)(66,"div",24)(67,"mat-form-field",25)(68,"mat-label"),n(69,"Hour"),e(),t(70,"mat-select",26),d(71,ke,2,2,"mat-option",27),e()(),t(72,"mat-form-field",25)(73,"mat-label"),n(74,"Minute"),e(),t(75,"mat-select",28),d(76,De,2,2,"mat-option",27),e()()(),t(77,"div",29)(78,"mat-label"),n(79,"Recurring Expense"),e(),t(80,"mat-slide-toggle",30),n(81,"Recurring"),e()()(),t(82,"div",5)(83,"mat-form-field",6)(84,"mat-label"),n(85,"Vehicle"),e(),t(86,"mat-select",31)(87,"mat-option",8),n(88,"Select Vehicle"),e(),d(89,Te,2,3,"mat-option",27),e()(),t(90,"mat-form-field",6)(91,"mat-label"),n(92,"Driver"),e(),t(93,"mat-select",32)(94,"mat-option",8),n(95,"Select Driver"),e(),d(96,Ne,2,2,"mat-option",27),e()()(),t(97,"div",33)(98,"button",34),h("click",function(){return _(p),E(i.onCancel())}),n(99,"Cancel"),e(),t(100,"button",35),d(101,Ve,1,0,"mat-spinner",36)(102,qe,2,1,"mat-icon",15),n(103),e()()()()()}if(r&2){let p,s,u,g,b=C(37);l(3),v(i.isEditMode?"Edit Fuel Expense":"Add New Fuel Expense"),l(7),m("formGroup",i.fuelExpenseForm),l(20),m("ngIf",((p=i.fuelExpenseForm.get("expense_type"))==null?null:p.invalid)&&((p=i.fuelExpenseForm.get("expense_type"))==null?null:p.touched)),l(4),m("matDatepicker",b),l(),m("for",b),l(3),m("ngIf",((s=i.fuelExpenseForm.get("expense_date"))==null?null:s.invalid)&&((s=i.fuelExpenseForm.get("expense_date"))==null?null:s.touched)),l(6),m("ngIf",((u=i.fuelExpenseForm.get("cost"))==null?null:u.invalid)&&((u=i.fuelExpenseForm.get("cost"))==null?null:u.touched)),l(16),m("ngIf",((g=i.fuelExpenseForm.get("quantity"))==null?null:g.invalid)&&((g=i.fuelExpenseForm.get("quantity"))==null?null:g.touched)),l(11),m("ngForOf",i.hours),l(5),m("ngForOf",i.minutes),l(13),m("ngForOf",i.vehicles),l(7),m("ngForOf",i.drivers),l(4),m("disabled",i.loading||i.fuelExpenseForm.invalid),l(),m("ngIf",i.loading),l(),m("ngIf",!i.loading),l(),S(" ",i.isEditMode?"Update":"Create"," Expense ")}},dependencies:[w,O,P,G,q,T,R,N,V,z,j,A,U,$,H,Y,Q,L,Z,X,J,K,W,te,ee,he,Ee,ge,oe,re,ne,ie,me,le,xe,ue,ce,fe,ve,Fe,be],styles:[".fuel-expense-form[_ngcontent-%COMP%]{max-width:800px;margin:0 auto;padding:20px}.form-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:32px;flex-wrap:wrap;gap:16px}.back-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:12px 20px;background:#718096;color:#fff;border:none;border-radius:8px;font-size:1rem;font-weight:500;cursor:pointer;transition:all .2s ease}.back-btn[_ngcontent-%COMP%]:hover{background:#4a5568;transform:translateY(-1px)}h2[_ngcontent-%COMP%]{margin:0;color:#1a202c;font-size:1.8rem}.expense-form[_ngcontent-%COMP%]{background:#fff;padding:32px;border-radius:12px;box-shadow:0 1px 3px #0000001a;display:flex;flex-direction:column;gap:24px}.form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:20px}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}label[_ngcontent-%COMP%]{font-weight:600;color:#2d3748;font-size:.9rem}.form-control[_ngcontent-%COMP%]{padding:12px 16px;border:2px solid #e2e8f0;border-radius:8px;font-size:1rem;transition:all .2s ease;background:#fff}.form-control[_ngcontent-%COMP%]:focus{outline:none;border-color:#4299e1;box-shadow:0 0 0 3px #4299e11a}.form-control[_ngcontent-%COMP%]:invalid:not(:placeholder-shown){border-color:#e53e3e}.error-message[_ngcontent-%COMP%]{color:#e53e3e;font-size:.85rem;font-weight:500;display:flex;align-items:center;gap:4px}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:12px;margin-top:16px;padding-top:24px;border-top:1px solid #e2e8f0}.cancel-btn[_ngcontent-%COMP%]{padding:12px 24px;background:#e2e8f0;color:#4a5568;border:none;border-radius:8px;font-size:1rem;font-weight:500;cursor:pointer;transition:all .2s ease}.cancel-btn[_ngcontent-%COMP%]:hover{background:#cbd5e0;transform:translateY(-1px)}.submit-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:12px 24px;background:#4299e1;color:#fff;border:none;border-radius:8px;font-size:1rem;font-weight:500;cursor:pointer;transition:all .2s ease}.submit-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#3182ce;transform:translateY(-1px)}.submit-btn[_ngcontent-%COMP%]:disabled{background:#a0aec0;cursor:not-allowed;transform:none}.loading-icon[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@media (max-width: 768px){.form-header[_ngcontent-%COMP%]{flex-direction:column;gap:15px;align-items:flex-start}.expense-form[_ngcontent-%COMP%]{padding:24px}.form-row[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:16px}.form-actions[_ngcontent-%COMP%]{flex-direction:column-reverse}.cancel-btn[_ngcontent-%COMP%], .submit-btn[_ngcontent-%COMP%]{width:100%;justify-content:center}}"]})};export{Me as FuelExpenseForm};
